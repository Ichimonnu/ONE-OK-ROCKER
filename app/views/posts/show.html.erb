<header>
<div class="header-list">
    <ul>
        <li><%= link_to t("models.post.posts list"), posts_path %></li>
    </ul>
</div>
</header>

<div class="top">
    <h3>Post detail</h3>
        <div class="gazou">
            <div class="post">
            <%= image_tag @post.user.image_url, size: "30x30", class: "imagepost" if @post.user.image? %>
            </div>
            <div class="post">
            <%= @post.user.name %>:
            </div>
            <div class="post">
            <%= @post.user.profile %>
            </div>
        </div>
    <div class="post">
        <p>曲名 (Title)：<%= @post.title %></p>
        <p>好きな理由 (Why do you like?)：<%= @post.content %></p>
        <p>好きな歌詞 (favorite lyric)：<%= @post.lyric %></p>
        <p>どんなときに聴く？ (genre)：<%= @post.genre %></p>

        <!--動画-->
        <p>
        <iframe width="560" height="315" src="https://www.youtube.com/embed/<%= @post.youtube_url%>" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </p>

        <!--時間表示-->
        <p><%= @post.created_at.strftime("%Y-%m-%d %H:%M") %></p>
    </div>

    <% if user_signed_in? %>
        <% if current_user.already_liked?(@post) %>
            <%= link_to post_like_path(@post), method: :delete do %>
                <i class="fas fa-heart"></i><%= @post.likes.count %>
            <% end %>
        <% else %>
            <%= link_to post_likes_path(@post), method: :post do %>
                <i class="far fa-heart"></i><%= @post.likes.count %>
            <% end %>
        <% end %>
    <% else %>
        <i class="far fa-heart"></i><%= @post.likes.count %>
    <% end %>

    <% if user_signed_in? && current_user.id == @post.user_id %>
        <%= link_to t("models.post.edit"), edit_post_path(@post.id) %>
    <% end %>

    <h4>Liked users</h4>

    <% @post.liked_users.each do |user| %>
        <li><%= user.name %></li>
    <% end %>

    <div class="comment-wrapper">
        <h4>Comment</h4>
        <% @comments.each do |c| %>
            <% if user_signed_in? && current_user.id == c.user_id %>
                <div>
                    <%= c.user.name unless c.user.blank? %>
                    <br>
                    <%= c.content %>
                </div>
                <br>
                <%= link_to t("models.post.delete"), post_comment_path(@post.id, c.id),method: :delete, data: { confirm: "really?" } %>
            <% else %>
                <div>
                    <%= c.user.name unless c.user.blank? %>
                    <br>
                    <%= c.content %>
                </div>
            <% end %>
        <% end %>

        <% if user_signed_in? %>
            <%= form_with(model: [@post, @comment], local: true) do |f| %>
                <%= f.text_area :content %>
                <%= button_tag type: "submit" do %>
                    <i class="far fa-comments"></i> comment
                <% end %>
            <% end %>
        <% end %>
    </div>
</div>